<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3 Page Template</title>
		<script type="text/javascript" src="d3/d3.js"></script>
		<style type='text/css'> 
			div.bar {
				display: inline-block;
				width: 20px;
				height: 75px;
				background-color: teal;
				margin-right: 2px;
			}
			
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
			
		</style>
	</head>
	<body>
		
		<p>Click on this text to update the chart with new data values (once).</p>
		
		<script type="text/javascript">
			//SVG Width and Height
			var w = 600;
			var h = 250;
			var xPadding = 0;
			var yPadding = 0;
			
			
			var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
							11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
			
			var svg = d3.select('body').append('svg')
						.attr('width', w)
						.attr('height', h);

			var xScale = d3.scaleBand()
							.domain(d3.range(dataset.length))
							.rangeRound([0, w])
							.paddingInner(0.15);
						
			var yScale = d3.scaleLinear()
							.domain([0, d3.max(dataset, function(d) { return d;} )])
							.range([h - yPadding, yPadding]);
			
			var tScale = d3.scaleLinear()
							.domain([0, d3.max(dataset, function(d) { return d;} ) ] )
							.range([0, 1]);
			
			svg.selectAll('rect')
				.data(dataset)
				.enter()
				.append('rect')
				.attr('x', function(d, i) { return i * xScale.step(); })
				.attr('y', function(d) { return yScale(d); })
				.attr('width', xScale.bandwidth())
				.attr('height', function(d) { return h - yPadding - yScale(d); } )
				.attr('fill', function(d) { return d3.interpolateViridis(tScale(d)); } );

			svg.selectAll('text')
				.data(dataset)
				.enter()
				.append('text')
				.text(function(d) { return d; } )
				.attr('x', function(d, i) { return i * xScale.step() + xScale.bandwidth() / 2; } )
				.attr('y', function(d) { 
						if( yScale(d) + 20 > h ) { 
							return yScale(d) - 3;
						} else { 
							return yScale(d) + 14; 
						} 
					} 
				)
				.attr('text-anchor', 'middle')
				.attr('font-family', 'sans-serif')
				.attr('font-size', '12px')
				.attr('fill', function(d) { if( yScale(d) + 20 > h || tScale(d) > 0.55) { 				return 'black'; 
						} else { 
							return 'white'; } } );
				
			d3.select('p')
				.on('click', function() {
				
					var numValues = dataset.length;
				
					dataset = [];
				
					for (var i = 0; i < numValues; i++) {
						dataset.push( Math.floor( Math.random() * 100 ) );
					}

					yScale.domain( [0, d3.max(dataset, function(d) { return d; } ) ] );
					tScale.domain( [0, d3.max(dataset, function(d) { return d; } ) ] );
					
					svg.selectAll('rect')
						.data(dataset)
						.transition()
						.delay( function(d, i) { 
							return i / dataset.length * 250;
						})
						.duration(500)
						.attr('y', function(d) { 
							return yScale(d); } )
						.attr('height', function(d) { 
							return h - yPadding - yScale(d); } )
						.attr('fill', function(d) { 
							return d3.interpolateViridis( tScale(d) ); } );
					
					svg.selectAll('text')
						.data(dataset)
						.transition()
						.delay( function(d, i) { 
							return i / dataset.length * 250;
						})
						.duration(500)
						.text(function(d) { return d; } )
						.attr('x', function(d, i) { 
							return i * xScale.step() + xScale.bandwidth() / 2; } )
						.attr('y', function(d) { 
								if( yScale(d) + 20 > h ) { 
									return yScale(d) - 3;
								} else { 
									return yScale(d) + 14; 
								} 
							} 
						)
						.attr('fill', function(d) { if( yScale(d) + 20 > h || tScale(d) > 0.55) { 				return 'black'; 
						} else { 
							return 'white'; } } );
							

					
				} ) ;
				
		</script>
	</body>
</html>